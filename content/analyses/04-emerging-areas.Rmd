---
title: "Emerging Employment Areas in Fairfax County"
output: html_document
description: "Project description here"
tags: ["R", "geospatial"]
weight: 4
draft: false
output: html_document
---

NOTES FOR THIS FILE:
* COLOR SCHEME
* ADD CONTENT AS NOTED

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE}
library(leaflet)
library(dplyr)
library(readxl)
library(readr)
library(sf)
```

```{r setup, include=FALSE}
# Get data
lodespatial <- read_rds("/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/lodes/lodes_spatial.Rds") # Sarah's LODES 2017 workplace + ACS spatial
fortune_geo <- read_sf("/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/fortune/fortune_1000/fairfax_fortune_1000_geo.shp") # Fortune 1000

employers <- read_excel('/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/original/vworks/allemployers.xlsx') %>%
  select_all(~gsub("\\s+|\\.", "_", .)) %>% 
  select_all(tolower) %>% 
  arrange(desc(estimate_of_employees)) %>% 
  slice_head(n = 100) # Susweta's top 100 largest employers
```

# Emerging Employment Areas in Fairfax County
We aim to identify the emerging areas in Fairfax County for employment opportunities. 
## Data and Methods
We used the address of the headquarter of the eleven companies from Fairfax County, that made into the 66th annual Fortune 1000 list, to locate where the emergent employers may be located.

We also obtained the data on employers in Fairfax County, from Virginia Employment Commission, which was then used to determine the top 100 employers in the county and to check where are they located.

## Findings
We plot the locations of the top 100 employers and the employers mentioned in Fortune 1000 list, against the quantile groups of total jobs in the country to see if these employers are successful to attract workers. All the three plots suggest that most of these employers are clustered in some areas. The number of workers employed by the top 100 employers varies between 400 and 8500.

### Where and Who are Fairfax County's Largest Employers?
The top five employers in Fairfax County are Sodexo, Inova Fairfax Hospital, George Mason University, AT&T Store and GMU Community Relations, each employing 4000 or more workers. Among these largest five employers, three are located in Springfield, Falls Church, Oakton and two in Fairfax City.
```{r}
pal <- colorQuantile(c("#60999A", "#D9E12B", "#E6CE3A", "#E6A01D", "#E57200"), employers$estimate_of_employees, probs = seq(0, 1, length = 6), right = FALSE)
labels <- lapply(
  paste("<strong>Company name: </strong>",
         employers$business_name,
        "<br />",
        "<strong>6 digit title: </strong>",
        employers$`6_digit_title`,
        "<br />",
        "<strong>Number of employees: </strong>",
        employers$estimate_of_employees),
        htmltools::HTML
  )
leaflet(data = employers, 
        options = leafletOptions(minZoom = 10)) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(data = employers, lng = employers$longitude, lat = employers$latitude, 
                   radius = 3.5, color = ~pal(estimate_of_employees), 
                   stroke = FALSE, fillOpacity = 1,
                   label = ~labels, labelOptions = labelOptions(noHide = F, direction = "bottom")) %>%
  addLegend("bottomleft", pal = pal, values = employers$estimate_of_employees, 
            title = "Estimated Number of Employees<br>by Quantile Group", opacity = 1, 
            labFormat = function(type = "quantile", cuts = 5, p = data1$estimate_of_employees) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

### Do Fortune 1000 Companies Attract Workers?
This interactive map shows the location of the companies in Fairfax County that have been mentioned in the Fortune 1000 list. We can click the blue dots on the map to see the company names. The plot shows that number of jobs are higher in the areas where these emplyers are located which indicates that the employers attract the workers by creating job opportunities.
```{r}
# Fortune 1000 HQ plot
pal <- colorQuantile("Oranges", domain = lodespatial$perTotalJobs, probs = seq(0, 1, length = 6), right = FALSE)

leaflet(data = lodespatial, 
        options = leafletOptions(minZoom = 10))%>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(fillColor = ~pal(perTotalJobs), fillOpacity = .7, stroke = FALSE) %>%
  addCircleMarkers(data = fortune_geo, popup = fortune_geo$Name, 
                   radius = 3.5,
                   color = "#232D4B",
                   stroke = FALSE, fillOpacity = 1) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values =  ~perTotalJobs,
            title = "Percent of All<br>Fairfax County Jobs,<br>by Quintile Group", 
            opacity = 1,
            labFormat = function(type = "quantile", cuts = 5, p = perTotalJobs) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

### How Many Workers do the Top 100 Employers Attract?
This interactive map shows the location of top 100 employers in fairfax County. By hovering over the blue dots on the map we can see the company names, which sector they belong to and the number of workers for each company. The largest employer is Sodexo, which is a food-service management company located in Springfield, employs 8500 workers. In total 111,590 workers are employed by the top 100 employers in fairfax County. 
```{r}
pal <- colorQuantile("Oranges", domain = lodespatial$perTotalJobs, probs = seq(0, 1, length = 6), right = FALSE)

labels <- lapply(
  paste("<strong>Company name:</strong>",
         employers$business_name,
        "<br />",
        "<strong>Sector:</strong>",
        employers$`6_digit_title`,
        "<br />",
        "<strong>Estimated number of employees:</strong>",
        employers$estimate_of_employees),
        htmltools::HTML
  )

leaflet(data = lodespatial,
        options = leafletOptions(minZoom = 10))%>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(fillColor = ~pal(perTotalJobs), fillOpacity = .7, stroke = FALSE) %>%
  addCircleMarkers(data = employers, label = ~labels, labelOptions = labelOptions(noHide = F, direction = "bottom"),
                   radius = 3.5,
                   color = "#232D4B",
                   stroke = FALSE, fillOpacity = 1) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values =  ~perTotalJobs,
            title = "Percent of All<br>Fairfax County Jobs,<br>by Quintile Group", 
            opacity = 1,
            labFormat = function(type = "quantile", cuts = 5, p = perTotalJobs) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

# References
Citations here.