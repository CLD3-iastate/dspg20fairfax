---
title: "Fairfax County Residents' Employment Characteristics"
output: html_document
description: "The page provides a demographic overview of Fairfax County residents."
tags: ["eda", "geospatial", "interactive map", "socio-demographics", "sectors"]
weight: 2
draft: false
---

```{css, echo=FALSE}
/* this chunnk of code centers all of the headings */
h1, h2, h3, h4 {
  text-align: center;
}
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = F, message = F, echo = F}
library(tidyverse)
library(leaflet)
library(shiny)
library(shinythemes)
library(sf)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(stringr)
```

```{r warning = F, message = F, echo = F}
# Get data
rac <- read_rds(paste0(here::here(), "/data/lodes/fairfax_rac.Rds")) # Sean's LODES 2017 residence tract data
```

```{r, warning = F, message = F, echo = F}
# Function to transform pie chart labels
pie_lab_transform <- function(data){
  data <- data %>% 
  arrange(desc(data)) %>%
  mutate(prop = value / sum(value) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )
}
```

### Approach 

This documents provides baseline census tract-level visualizations for characteristics of Fairfax County residents who are in the labor force. Along with sociodemographic characteristics like workers' age, ethnicity, level of education, and median income, we also consider how long workers residing in  different parts of the county have to travel to get to their work site, what industries they work in, and what their occupations are. Better understanding the characteristics of Fairfax County residents in the labor force is the first step to later identifying groups at risk of pandemic-related income and job loss.

We used the Residence Area Characteristic data (RAC) from the Origin-Destination Employment Statistics (LODES) dataset generated by the US Census Bureau as a part of their Longitudinal Employer-Household Dynamics (LEHD) program. For our purpose, we used the data from 2017, which is the latest LODES data available. The data files for LODES are state-based and include Origin-Destination, Residence Area Characteristics, and Workplace Area Characteristics files. This dataset provides census block group-level geographic resolution and can be aggregated to higher units of analysis. We used the dataset to retrieve information on age, education, race, ethnicity, monthly income, and industry sector of employed Fairfax County residents. 

We also used the latest available American Community Survey (ACS) 5-year estimates, spanning 2014 to 2018. ACS is a nationally representative household conducted by the US Census Bureau. It provides data on population social, economic, and housing characteristics, and has census block group level geographic resoluton. We used ACS to extract tract-level data on employed Fairfax County residents' means of commute to work, class of work, and major industries.

### Fairfax County Residents in the Labor Force

### Sociodemographic Characteristics

This following chart displays the age distribution of county residents in the labor force. It indicates that 23% of county residents are at or nearing retirement age. Another 56% of the work force is aged 30 to 54 years, while 21% of the workers are 29 years old or younger, likely beginning their work careers.

```{r, echo = F}
age <- data.frame(age=names(colSums(rac[, 3:5])), value=colSums(rac[, 3:5]), row.names=NULL)
age <- pie_lab_transform(age)

ggplot(age, aes(x="", y=prop, fill=age)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  scale_fill_manual(values = c("#E6A01D","#60999A","#232D4B")) +
  geom_text(aes(y = ypos, label = paste(age, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Age Structure of Employed Fairfax County Residents", 
       subtitle = "LODES Residence Characteristics, 2017") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 
```

The county's employed residents are predominantly white, followed by Asian and Black African American workers.

```{r, echo = F}
race <- data.frame(race=names(colSums(rac[, 29:34])), value=colSums(rac[,29:34]), row.names=NULL)
race <- pie_lab_transform(race)

for(i in  c("Race:", ",Alone", "Alone", "10")){
  race$race <- gsub(i, "", race$race)
}

race$race <- c("White", "Two or More \n Racial Groups", "Native Hawaiian or \n Other Pacific Islander",
               "Black or \n African American", "Asian", "American Indian \n or Alaska Native")
pal <- c("#232D4B", "#2C4F6B", "#0E879C", "#60999A", "#E6A01D", "#E57200", "#E6CE3A")
ggplot(race, aes(x = prop, y = reorder(race, prop), fill = race)) +
  geom_bar(stat= "identity")+
  theme_minimal() +
  scale_fill_manual(values = pal) +
  labs(title = "Race of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none",
        plot.title = element_text(hjust = 0.3),
        plot.subtitle = element_text(hjust = 0.26)) 
```

Only a minority, or 14% of the county's worker population, are Hispanic or Latino.

```{r, echo = F}
ethnicity <- data.frame(ethnicity=names(colSums(rac[,35:36])), value=colSums(rac[, 35:36]), row.names=NULL)
ethnicity <- pie_lab_transform(ethnicity)

for(i in  c("Ethnicity:", "10")){
  ethnicity$ethnicity <- gsub(i, "", ethnicity$ethnicity)
}

ggplot(ethnicity, aes(x="", y=prop, fill=ethnicity)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  scale_fill_manual(values = c("#E6A01D", "#60999A")) +
  geom_text(aes(y = ypos, label = paste(ethnicity, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Ethnicity of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 
```

County residents in the workforce are highly educated. Approximately 43% of the employed population has at least a Bachelor's degree, indicating a highly skilled workforce. More than 25% have at least an associate's degree. Another 19% graduated from high school or equivalent, but do not have a college degrees, and only 13% of the residents have less than a high school degree.

```{r, echo = F}
education <- data.frame(education=names(colSums(rac[,37:40])), value=colSums(rac[, 37:40]), row.names=NULL)
education <- pie_lab_transform(education)

for(i in  c("EducationalAttainment:", "10,11")){
  education$education <- gsub(i, "", education$education)
}

ggplot(education, aes(x="", y=prop, fill=education)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  scale_fill_manual(values = c("#232D4B","#0E879C", "#E6A01D", "#60999A")) +
  geom_text(aes(y = ypos, label = paste(education, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Education of Employed Fairfax County Residents", 
       subtitle = "LODES Residence Characteristics, 2017") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 
```

### Employment Characteristics

Over 58% of the county's employed residents earn a salary over \$3,333 per month. Another 24% earn a salary between \$1,251 and \$3,333 per month. The remaining 18% earn an income below \$1,250 per month.

```{r, echo = F}
earnings <- data.frame(earnings=names(colSums(rac[, 6:8])), value=colSums(rac[, 6:8]), row.names=NULL)

earnings$earnings <- gsub("earnings", "", earnings$earnings)

earnings <- pie_lab_transform(earnings)

ggplot(earnings, aes(x="", y=prop, fill=earnings)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  scale_fill_manual(values = c("#0E879C", "#E6A01D","#232D4B")) +
  theme(legend.position="none") +
  geom_text(aes(y = ypos, label = paste(earnings, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Earnings Structure of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 
```

We examined residents' employment by industry sector and found that the majority of employed Fairfax County residents hold jobs in profesional, scientific and technical services. The next top four industries employing Fairfax County residents are education services, health care, accomodation and food services, and retail trade.

```{r, fig.height = 6, echo = F}
naic <- data.frame(naic=names(colSums(rac[,9:28])), value=colSums(rac[, 9:28]), row.names=NULL)

naic$naic <- unlist(str_extract_all(naic$naic,  "(?<=\\().+?(?=\\))"))
naic$naic <- gsub("and", "&", naic$naic)
naic <- pie_lab_transform(naic)
naic$naic <- c("Wholesale Trade", "Utilities", "Transportation & Warehousing",
               "Retail Trade", "Real Estate & Rental & Leasing", "Public Administration",
               "Professional, Scientific,\n & Technical Services", "Other Services",
               "Mining, Quarrying,\n & Oil & Gas Extraction", "Manufacturing",
               "Management of Companies\n & Enterprises", "Information", 
               "Health Care & Social Assistance", "Finance & Insurance", "Educational Services",
               "Construction", "Arts, Entertainment, & Recreation", 
               "Agriculture, Forestry,\n Fishing & Hunting",
               "Administrative & Support & Waste\n Management & Remediation Services",
               "Accommodation & Food Services")

ggplot(naic, aes(x = as.numeric(prop), y = reorder(naic,prop), fill = naic)) +
  geom_bar(stat= "identity") +
  scale_fill_manual(values = c("#232D4B", "#0E879C","#60999A", "#37909B", "#195A74","#4C959B", 
                               "#232D4B", "#0E879C","#60999A", "#37909B", "#195A74","#4C959B", 
                               "#232D4B", "#0E879C","#60999A", "#37909B", "#195A74","#4C959B", 
                               "#232D4B", "#0E879C","#60999A"
                               )) +
  theme_minimal() +
  labs(title = "Industry of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none", 
        plot.title = element_text(hjust = 0.1),
        plot.subtitle = element_text(hjust = 0.2)) 
```

### Exploring Work Commutes, Class of Work, and Industries

To visualize residents' employment characteristics at census tract level, we produced interactive maps using ACS data. We visualize means of commute to work, class of work, and work industries by residence tract. Clicking on the tabs and selecting a variable populates the map, and hovering over the map displays the percentage of residents living in a given tract with the selected characteristic.

You can explore the means of commute to work for employed Fairfax County residents by their residence census tract using the app below. For example, the app shows that residents in the cities like Springfield and Mount Vernon depend more on public transit than residents in other parts of the county. Residents in Springfield and Dranesville commute 30 minutes or more to get to their workplaces. The class of work maps also show that Springfield and Dranesville have comparatively lower percentages of residents employed in private jobs and a high proportion of residents holding government jobs. Finally, the industry maps show that many residents around Providence have jobs in professional, scientific, and management sectors, while many residents in Springfield, Mount Vernon, and Dranesville hold jobs in healthcare, social assistance, and educational services. Sully and Mount Vernon have large percentages of residents employed in arts, entertainment, and recreation service sectors.

```{r, echo=FALSE, fig.fullwidth=TRUE}
# Maps
knitr::include_app('https://teja.shinyapps.io/app_res/', height = "650px")
```

# References
https://lehd.ces.census.gov/
https://www.census.gov/programs-surveys/acs