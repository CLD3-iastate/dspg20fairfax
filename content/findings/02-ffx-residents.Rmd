---
title: "Fairfax County Residents' Employment Characteristics"
output: html_document
description: "Project description here"
tags: ["R", "geospatial"]
weight: 2
draft: false
---

NOTES FOR THIS DOCUMENT:
* ADD CONTENT AS MARKED.

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = F, message = F, echo = F}
library(tidyverse)
library(leaflet)
library(shiny)
library(shinythemes)
library(sf)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(stringr)
```

```{r warning = F, message = F, echo = F}
# Get data
rac <- read_rds("/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/lodes/fairfax_rac.Rds") # Sean's LODES 2017 residence tract data
```

```{r, warning = F, message = F, echo = F}
# Function to transform pie chart labels
pie_lab_transform <- function(data){
  data <- data %>% 
  arrange(desc(data)) %>%
  mutate(prop = value / sum(value) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )
}
```

# Fairfax County Residents' Employment Characteristics
We aim to visualize the baseline characteristics of the residents of Fairfax County who are in the labor force. Along with the sociodemographic characteristics, like residents' age, ethnicity, level of education and monthly income, we als looked into how long the residents from different part of the county have to travel every day to get to their work, what are the major industries and job sectors in the county. Once we characterize the labor force in the county, we can identify the more vulnerable groups or areas in Fairfax County.

## Data and Methods
We used the Residence Area Characteristic data (RAC) from the Origin-Destination Employment Statistics (LODES) dataset generated by the U.S. Census Bureau as a part of their Longitudinal Employer-Household Dynamics (LEHD) program. For our purpose we used the data from 2017 which is the latest LODES data available. The data files for LODES are state-based and include Origin-Destination, Residence Area Characteristics and Workplace Area Characteristics. This dataset is built on census block groups as the smallest unit and available up to national level. We used the dataset to get the data on age, education, ethnicity and monthly income of the residents of fairfax County. 

We also, used latest American Community Survey data (2014 - 2018) available, to obtain tract level information on means of commute to work, worker classes and major industries employing the residents of the county. This is a 5 year survey data on social, economic, housing and demography, collected by U.S. Census Bureau and ranges from national level to block group level. This dataset was used to extract data on the Fairfax County's resident' means of commute to work, major job sectors and major industries in the county.

## Fairfax County Residents in Labor Force
We looked into basic sociodemographic characteristics, like age, education, race of the residents of Fairfax County who are in the labor force. Which gave us an insight about the composition of the work force.

## Sociodemographic Characteristics
This piechart gives us an idea about what proportion of the residents of the county who are in the work force are about to retire, which is 23%. While almost 56% of the work force is in the range of 30 to 54 years and around 21% of the workers are 29 years old or younger.
```{r, echo = F}
age <- data.frame(age=names(colSums(rac[, 3:5])), value=colSums(rac[, 3:5]), row.names=NULL)
age <- pie_lab_transform(age)

ggplot(age, aes(x="", y=prop, fill=age)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  geom_text(aes(y = ypos, label = paste(age, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Age Structure of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017")
```

The county's population is predominantly white, followed by Asian and Black African American.
```{r, echo = F}
race <- data.frame(race=names(colSums(rac[, 29:34])), value=colSums(rac[,29:34]), row.names=NULL)
race <- pie_lab_transform(race)

for(i in  c("Race:", ",Alone", "Alone", "10")){
  race$race <- gsub(i, "", race$race)
}

ggplot(race, aes(x = prop, y = reorder(race, prop), fill = race)) +
  geom_bar(stat= "identity")+
  theme_minimal() +
  labs(title = "Race of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none")
```
This piechart shows that only 14% of the county's population are Hispanic or Latino.
```{r, echo = F}
ethnicity <- data.frame(ethnicity=names(colSums(rac[,35:36])), value=colSums(rac[, 35:36]), row.names=NULL)
ethnicity <- pie_lab_transform(ethnicity)

for(i in  c("Ethnicity:", "10")){
  ethnicity$ethnicity <- gsub(i, "", ethnicity$ethnicity)
}

ggplot(ethnicity, aes(x="", y=prop, fill=ethnicity)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  geom_text(aes(y = ypos, label = paste(ethnicity, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Ethnicity of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017")
```

This piechart shows that over 43% of the population in Fairfax County has at least a Bachelor's degree, which indicates a highly skilled workforce. More than 25% of the population has at least some associate degree and almost 19% of the residents graduated from high school or equivalent but do not have any college degrees. Only 13% of the residents have a dgree less than high school.
```{r, echo = F}
education <- data.frame(education=names(colSums(rac[,37:40])), value=colSums(rac[, 37:40]), row.names=NULL)
education <- pie_lab_transform(education)

for(i in  c("EducationalAttainment:", "10,11")){
  education$education <- gsub(i, "", education$education)
}

ggplot(education, aes(x="", y=prop, fill=education)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  geom_text(aes(y = ypos, label = paste(education, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Education of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017")
```

### Employment Characteristics
The piechart indicates that over 58% of the county's population earn a salary over $3333 per month. Little less than 24% of the resident earn a salary between $1251 and $3333 per month. And around 18% of the residents have a income below $1250 per month.
```{r, echo = F}
earnings <- data.frame(earnings=names(colSums(rac[, 6:8])), value=colSums(rac[, 6:8]), row.names=NULL)

earnings$earnings <- gsub("earnings", "", earnings$earnings)

earnings <- pie_lab_transform(earnings)

ggplot(earnings, aes(x="", y=prop, fill=earnings)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  geom_text(aes(y = ypos, label = paste(earnings, "\n", paste(round(prop, 2), "%"))), color = "white", size=3) +
  labs(title = "Earnings Structure of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017")
```

### Which industry sectors employ Fairfax County residents?
We also looked into the employment by different industry sectors and find that the residents of Fairfax County are emplyed mainly in profesional, scientific and technical services. The next top four industries in the county are education services, health care sector, accomodation & food services and retail trade.
```{r, echo = F}
naic <- data.frame(naic=names(colSums(rac[,9:28])), value=colSums(rac[, 9:28]), row.names=NULL)

naic$naic <- unlist(str_extract_all(naic$naic,  "(?<=\\().+?(?=\\))"))
naic$naic <- gsub("and", "&", naic$naic)
naic <- pie_lab_transform(naic)

ggplot(naic, aes(x = prop, y = reorder(naic,prop), fill = naic)) +
  geom_bar(stat= "identity") +
  theme_minimal() +
  labs(title = "Industry of Employed Fairfax County Residents", subtitle = "LODES Residence Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none")
```

### Exploring Work Commutes, Worker Classes, and Industries
We produce an interactive map, using the ACS data, to visualize the means of commute to work, worker classes and different industries the resident workers are employed in. By clicking on the tabs and then selecting a variable you can access the map for that particular variable and by hovering over each map you can see the percentage of residents under different categories for each tract in the county.

You can explore the means of commute to work for the Fairfax County workforce by residence census tract using the app below. For example, you can see that residents in the cities like Springfield, Mount Vernon depend more on public tans port compared to other cities in the county. Also, people in Springfield and Dranesville commute 30 minutes or more to get to their workplaces. The work class maps shows that Springfield and Dranesville have comparatively lower percentage of private jobs and a high proportion of government jobs. The industry maps show that jobs in professional, scientific and management sectors are mainly concentrated around Providence, whereas, healthcare and social assistance industry and educational services are concentrated mainly in Springfield, Mount vernon and Dranesville. Sully and Mount Vernon have a prominent arts, entertainment and recreation service sector.
```{r warning = F, message = F, echo = F}
# Shiny app goes here, I just need to integrate it.
# See the app at https://teja.shinyapps.io/app_res/
```

# References
https://lehd.ces.census.gov/
https://www.census.gov/programs-surveys/acs