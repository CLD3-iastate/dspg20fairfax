---
title: "Workers in Fairfax County"
output: html_document
description: "Project description here"
tags: ["R", "geospatial"]
weight: 1
draft: false
---

NOTES FOR THIS DOCUMENT:
* LODES PLOTS NEED TO HAVE THE COLOR SCHEME REVISED + LABELS CLEANED UP (SPACES ETC)
* ADD CONTENT AS MARKED.

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = F, message = F, echo = F}
library(tidyverse)
library(viridis)
library(sf)
library(RColorBrewer)
library(leaflet)
library(ggrepel)
library(stringr)
```

```{r warning = F, message = F, echo = F}
# Get data
work <- read_rds("/sfs/qumulo/qhome/kb7hp/git/dspg20fairfax/data/acs/wrk_ACS_data.Rds") # Owen's ACS 2014/18 workplace tract data
wac <- read_rds("/sfs/qumulo/qhome/kb7hp/git/dspg20fairfax/data/lodes/fairfax_wac.Rds") # Sarah's LODES 2017 workplace tract data
#work <- read_rds("./data/acs/wrk_ACS_data.Rds") # Owen's ACS 2014/18 workplace tract data
#wac <- read_rds("./data/lodes/fairfax_wac.Rds") # Sarah's LODES 2017 workplace tract data
```

```{r, warning = F, message = F, echo = F}
# Function to transform pie chart labels
pie_lab_transform <- function(data){
  data <- data %>% 
  arrange(desc(data)) %>%
  mutate(prop = value / sum(value) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )
}
```

# Workforce in Fairfax County
In order to tackle characterizing the Fairfax County workforce, we pulled in relevant ACS and LODES data for all who are employed in Fairfax County; both workplace and resident’s census tracts.  As this project focuses on employment and labor force sectors, understanding the current labor force is crucial for moving forward and analyzing how it will change as job sectors change.

## Data and Methods
When conducting our analysis and explorations we used both ACS and LODES data.  The American Community Survey (ACS) is a reoccurring survey by the U.S. Census Bureau. The tables it contains include information such as ancestry, citizenship, educational attainment, income, language proficiency, migration, disability, employment, and housing characteristics.  For our project we were particularly focused on the demographic, behavior, and employment information. We also used LODES workforce characteristics data to conduct further demographic analysis, breaking down workforce by race, gender, educational attainment and more in order to successfully characterize the workforce.

## Workers in Fairfax County
Overall, we have found that in Fairfax County employs many white-collar professional workers.  The highest employed sector is the Professional, Scientific & Technical services.  Following this, 45% of the workforce has received a bachelor's degree and more than 60% receive a salary of greater than $3,000 / month.

### What is the sociodemographic composition of workers in Fairfax County?
Fairfax County has a majority white workforce at greater than 60%, followed by Black, then Asian (both less than 20%).  There is also a small Hispanic population at about 12% of workers, and the gender breakdown is 47.7% female, 52.3% male.

```{r, echo = F}
race <- data.frame(race = names(colSums(wac[, 29:34])), value = colSums(wac[,29:34]), row.names = NULL)
race <- pie_lab_transform(race)

for(i in  c("Race:", ",Alone", "Alone", "10")){
  race$race <- gsub(i, "", race$race)
}
race$race <- c("White", "Two or More Race Groups", "Native Hawaiian or Other Pacific Islander",
               "Black or African American", "Asian", "American Indian or Alaska Native")
pal <- c("#232D4B", "#2C4F6B", "#0E879C", "#60999A", "#D1E0BF", "#E57200", "#E6CE3A")
ggplot(race, aes(x = prop, y = reorder(race, prop), fill = race)) +
  geom_bar(stat = "identity")+
  theme_minimal() +
  scale_fill_manual(values = pal) +
  labs(title = "Fairfax County Jobs by Race", subtitle = "LODES Workforce Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none") 
```

For all workers in Fairfax county, breaking them out by ethnicity we see that the vast majority are not Hispanic or Latino, with only 12.13% identifying as such.  When considering employment changes due to the COVID-19 pandemic, it is important to take into consideration how much of the population will likely be disproportionately impacted.  Underrepresented minorities have less access to jobs and jobs security, which can leave them in a precarious state during the uncertainty the pandemic is bringing.  Using this plot and the plot above, we can begin to understand who and where the effects of employment changes be most felt.
```{r, echo = F}
ethnicity <- data.frame(ethnicity = names(colSums(wac[,35:36])), value = colSums(wac[, 35:36]), row.names = NULL)
ethnicity <- pie_lab_transform(ethnicity)

for(i in  c("Ethnicity:", "10")){
  ethnicity$ethnicity <- gsub(i, "", ethnicity$ethnicity)
}
ethnicity$ethnicity <- c("Not Hispanic or Latino", "Hispanic or Latino")
ggplot(ethnicity, aes(x="", y = prop, fill = ethnicity)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start=0) +
  theme_void() +
  scale_fill_manual(values = c("#E6A01D", "#60999A")) +
  theme(legend.position = "none") +
  geom_text(aes(y = ypos, label = paste(ethnicity, "\n", paste(round(prop, 2), "%"))), color = "white", size = 3) +
  labs(title = "Fairfax County Jobs by Ethnicity", subtitle = "LODES Workforce Characteristics, 2017")
```

The workforce breakdown by sex, is relatively even and representative of the national breakdown.  This is of interest for framing our thinking around how will who is currently participating in the workforce change over time.
```{r, echo = F}
sex <- data.frame(sex = names(colSums(wac[,41:42])), value = colSums(wac[, 41:42]), row.names = NULL)
sex <- pie_lab_transform(sex)

for(i in  c("Sex:", "10")){
  sex$sex <- gsub(i, "", sex$sex)
}

ggplot(sex, aes(x="", y=prop, fill=sex)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  scale_fill_manual(values = c("#E6A01D", "#60999A")) +
  geom_text(aes(y = ypos, label = paste(sex, "\n", paste(round(prop, 2), "%"))), color = "white", size = 3) +
  labs(title = "Fairfax County Jobs by Sex", subtitle = "LODES Workforce Characteristics, 2017")

```

### How educated are workers in Fairfax County?
With 45% of workers receiving a bachelor’s degree or higher, we can say the workforce is highly educated.  This type of breakdown is crucial in creating a sense for landscape of the employment opportunities in Fairfax.  Highly education workers likely work in more white-collar occupations which have a much easier time transitioning to working from home than the retail or hospitality industries.
```{r, echo = F}
education <- data.frame(education=names(colSums(wac[,37:40])), value=colSums(wac[, 37:40]), row.names = NULL)
education <- pie_lab_transform(education)

for(i in  c("EducationalAttainment:", "10,11")){
  education$education <- gsub(i, "", education$education)
}
education$education <- c("Some College or Associate\ndegree",
                         "Less than High School",
                         "High School or Equivalent,\nNo College",
                         "Bachelor's Degree or\n Advanced Degree")

ggplot(education, aes(x="", y=prop, fill=education)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  theme(legend.position="none") +
  scale_fill_manual(values = pal) +
  geom_text(aes(y = ypos, label = paste(education, "\n", paste(round(prop, 2), "%"))), color = "white", size = 3) +
  labs(title = "Fairfax County Jobs by Education", subtitle = "LODES Workforce Characteristics, 2017")
```

### How much do workers in Fairfax County earn?
From this, we can take away that the workforce in Fairfax County is that the majority of workers earn in the top category of more than 3,333 / month.  This number however, is below the national average of worker's salaries per month of 3,828/month.  Nonetheless, we can understand that the opportunities to earn in Fairfax County are large, part of which may be due to the highly educated workforce.
```{r, echo = F}
earnings <- data.frame(earnings = names(colSums(wac[, 6:8])), value = colSums(wac[, 6:8]), row.names = NULL)
earnings$earnings <- gsub("earnings", "", earnings$earnings)
earnings <- pie_lab_transform(earnings)


earnings$earnings <- c("Greater than $3,333", "$1,251 to $3,333", "$1,250 or less")
ggplot(earnings, aes(x = "", y = prop, fill = earnings)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  theme_void() +
  theme(legend.position = "none") +
  scale_fill_manual(values = pal) +
  geom_text(aes(y = ypos, label = paste(earnings, "\n", paste(round(prop, 2), "%"))), color = "white", size = 3) +
  labs(title = "Fairfax County Jobs by Monthly Earnings", subtitle = "LODES Workforce Characteristics, 2017")
```

### Which industry sectors employ workers in Fairfax County?
This bar chart shows the share of sectors the labor force occupies.  The sector with highest worker density is the Professional, Scientific & Technical services.  This continues the idea that the Fairfax County workforce is generally highly educated, has opportunity to earn, and the majority of employment opportunities will not be impacted by the pandemic.  That is not to say that there will not be pandemic effect; the Healthcare Service and Retail sector are the second and third most employed industries.  There will likely be permanent changes and effects to these sectors, and many workers may have to reskill and find themselves in a new industry.
```{r, echo = F}
naic <- data.frame(naic = names(colSums(wac[,9:28])), value = colSums(wac[, 9:28]), row.names = NULL)

naic$naic <- unlist(str_extract_all(naic$naic,  "(?<=\\().+?(?=\\))"))
naic$naic <- gsub("and", "&", naic$naic)
naic <- pie_lab_transform(naic)
naic$naic <- c("Wholesale Trade", "Utilities", "Transportation & Warehousing",
               "Retail Trade", "Real Estate & Rental & Leasing", "Public Administration",
               "Professional, Scientific, & Technical Services", "Other Services",
               "Mining, Quarrying, & Oil & Gas Extraction", "Manufacturing",
               "Management of Companies & Enterprises", "Information", 
               "Health Care & Social Assistance", "Finance & Insurance", "Educational Services",
               "Construction", "Arts, Entertainment, & Recreation", 
               "Agriculture, Forestry, Fishing & Hunting",
               "Administrative & Support &\nWaste Management & Remediation Services",
               "Accommodation & Food Services")
ggplot(naic, aes(x = as.numeric(prop), y = reorder(naic,prop), fill = prop)) +
  geom_bar(stat= "identity") +
  scale_fill_gradient(low="#D1E0BF",high="#2C4F6B") +
  theme_minimal() +
  labs(title = "Fairfax County Jobs by NAIC Sector Code", subtitle = "LODES Workforce Characteristics, 2017", y = "", x = "%")+
  theme(legend.position="none") 
```

### How do workers get to their workplaces? Where are young and older adult workers?
These maps contain more socio-demographic statistics, demographic information, and workforce characteristics. On the first tab, using the workplace-tract level data (meaning data for people who work in the county regardless of where they live), we have broken down transportation to work by type. All of these variables are highly interesting.  Looking at areas where single person transit is important because these places will experience little effects of the efforts to get to work in a "socially distant" way.  Looking at areas where people carpooled and used public transit are also interesting because as we become more conscious of those we share close space with (and public transit shutdowns), it is important to know the areas which will be most affected.  On the other tab, we show census tracts by percent of workers in certain age brackets.  Looking at “Percent of workers age 60-64”, we can begin to understand the pockets of Fairfax County which may experience decline in employment due to early retirement by the aging work force.  Having this granularity will allow us to parse out workforce changes based on retirement vs pandemic effects.
```{r warning = F, message = F, echo = F}
# Map: Age groups
# App goes here. See at https://teja.shinyapps.io/app_wrk
```

# References
Cite references here. Use a consistent format.
