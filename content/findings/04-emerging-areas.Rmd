---
title: "Emerging Employment Areas in Fairfax County"
description: "Project description here"
tags: ["R", "geospatial"]
weight: 4
draft: false
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(leaflet)
library(dplyr)
library(readxl)
library(readr)
library(sf)
```

```{r, include=FALSE}
# Get data
lodespatial <- read_rds("/sfs/qumulo/qhome/kb7hp/git/dspg20fairfax/data/lodes/lodes_spatial.Rds") # Sarah's LODES 2017 workplace + ACS spatial
fortune_geo <- read_sf("/sfs/qumulo/qhome/kb7hp/git/dspg20fairfax/data/fortune/fortune_1000/fairfax_fortune_1000_geo.shp") # Fortune 1000

# Get data
#lodespatial <- read_rds("/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/lodes/lodes_spatial.Rds") # Sarah's LODES 2017 workplace + ACS spatial
#fortune_geo <- read_sf("/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/fortune/fortune_1000/fairfax_fortune_1000_geo.shp") # Fortune 1000

employers <- read_excel('/sfs/qumulo/qhome/tp2sk/Git/dspg20fairfax/data/original/vworks/allemployers.xlsx') %>%
  select_all(~gsub("\\s+|\\.", "_", .)) %>% 
  select_all(tolower) %>% 
  arrange(desc(estimate_of_employees)) %>% 
  slice_head(n = 100) # Susweta's top 100 largest employers
```

# Emerging Employment Areas in Fairfax County
One of our objective for the project was to identify the emerging areas in Fairfax County for employment and business opportunities. Identification of areas with business and employment opportunities will help the local authority to formulate policies supporting these areas and also improve other areas that do not attract many business initiatives.
## Data and Methods
Out of the thirty five companies from Fairfax County that appeared in the 66th annual Fortune 1000 list, eleven of them made into the Fortune 500 list. We used the address of the headquarter of these eleven companies, to locate where the emergent employers may be located. Fortune 1000 is a list published by Fortune Magazine every year which contains top 1000 US companies ranked by the revenues. This list also includes attributes like revenue change from last year, profits, profit change from last year, assets, market value, number of employees, previous year's rank for a company. We used the latest data available, which is for the year 2020, for our analysis.

We also obtained the data on employers in Fairfax County, from Virginia Employment Commission's website. The data on the employers in the state are publicly available and can be filtered based on the particular business name, workforce areas, specific industry as well as for different counties, cities, zip codes and even for different categories of industry. We used the data for 2020, which is the latest data available, to determine the top 100 employers in the county and where they are located.

## Findings
We plot the locations of the top 100 employers and the employers mentioned in Fortune 1000 list, against the quantile groups of total jobs in the country to see if these employers are successful to attract workers. All the three plots suggest that most of these employers are clustered in some areas. The number of workers employed by the top 100 employers varies between 400 and 8500.

### Where and Who are Fairfax County's Largest Employers?
The top five employers in Fairfax County are Sodexo, Inova Fairfax Hospital, George Mason University, AT&T Store and GMU Community Relations, each employing 4000 or more workers. Among these largest five employers, three are located in Springfield, Falls Church, Oakton and two in Fairfax City. The plot shows that the employers are clustered around cities (NOT ALL OF THEM ARE CITIES??) like Tysons Corner, Fair Oaks, Merrifield, Chantilly, Reston.
```{r, warning=FALSE, message=FALSE, echo=FALSE}
pal <- colorQuantile(c("#60999A", "#D9E12B", "#E6CE3A", "#E6A01D", "#E57200"), employers$estimate_of_employees, probs = seq(0, 1, length = 6), right = FALSE)

labels <- lapply(
  paste("<strong>Company name: </strong>",
         employers$business_name,
        "<br />",
        "<strong>6 digit title: </strong>",
        employers$`6_digit_title`,
        "<br />",
        "<strong>Number of employees: </strong>",
        employers$estimate_of_employees),
        htmltools::HTML
  )
leaflet(data = employers, 
        options = leafletOptions(minZoom = 10)) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(data = employers, lng = employers$longitude, lat = employers$latitude, 
                   radius = 3.5, color = ~pal(estimate_of_employees), 
                   stroke = FALSE, fillOpacity = 1,
                   label = ~labels, labelOptions = labelOptions(noHide = F, direction = "bottom")) %>%
  addLegend("bottomleft", pal = pal, values = employers$estimate_of_employees, 
            title = "Estimated Number of Employees<br>by Quantile Group", opacity = 1, 
            labFormat = function(type = "quantile", cuts = 5, p = data1$estimate_of_employees) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

### Do Fortune 1000 Companies Attract Workers?
This interactive map shows the location of the companies in Fairfax County that have been mentioned in the Fortune 1000 list. You can click the blue dots on the map to see the company names. The plot indicates that these employers are clustered around Tyson Corner, Reston which is consistent with our findings from the top 100 employers location in Fairfax County.  The plot also shows that number of jobs are higher in the areas where these emplyers are located which indicates that these employers attract the workers by creating significant job opportunities in the county. 
```{r, warning=FALSE, message=FALSE, echo=FALSE}
# Fortune 1000 HQ plot
pal <- colorQuantile("Oranges", domain = lodespatial$perTotalJobs, probs = seq(0, 1, length = 6), right = FALSE)

leaflet(data = lodespatial, 
        options = leafletOptions(minZoom = 10))%>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(fillColor = ~pal(perTotalJobs), fillOpacity = .7, stroke = FALSE) %>%
  addCircleMarkers(data = fortune_geo, popup = fortune_geo$Name, 
                   radius = 3.5,
                   color = "#232D4B",
                   stroke = FALSE, fillOpacity = 1) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values =  ~perTotalJobs,
            title = "Percent of All<br>Fairfax County Jobs,<br>by Quintile Group", 
            opacity = 1,
            labFormat = function(type = "quantile", cuts = 5, p = perTotalJobs) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

### How Many Workers do the Top 100 Employers Attract?
We produced an interactive map showing the locations for the top 100 employers in Fairfax County. By hovering over the blue dots on the map you can see the company names, which sector they belong to and the number of workers for each company. The largest employer is Sodexo, which is a food-service management company located in Springfield, employs 8500 workers. In total 111,590 workers are employed by the top 100 employers in fairfax County. As we can see the cities see a higher number of job opportunities where some of these top 100 largest employers are clustered which is expected. You can also see that cities like Springfield, Mt. Vernon, Dranesville who have very few or none of these largest employers have the lowest number of jobs among the cities in the county.

```{r, warning=FALSE, message=FALSE, echo=FALSE}

pal <- colorQuantile("Oranges", domain = lodespatial$perTotalJobs, probs = seq(0, 1, length = 6), right = FALSE)

labels <- lapply(
  paste("<strong>Company name:</strong>",
         employers$business_name,
        "<br />",
        "<strong>Sector:</strong>",
        employers$`6_digit_title`,
        "<br />",
        "<strong>Estimated number of employees:</strong>",
        employers$estimate_of_employees),
        htmltools::HTML
  )

leaflet(data = lodespatial,
        options = leafletOptions(minZoom = 10))%>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(fillColor = ~pal(perTotalJobs), fillOpacity = .7, stroke = FALSE) %>%
  addCircleMarkers(data = employers, label = ~labels, labelOptions = labelOptions(noHide = F, direction = "bottom"),
                   radius = 3.5,
                   color = "#232D4B",
                   stroke = FALSE, fillOpacity = 1) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values =  ~perTotalJobs,
            title = "Percent of All<br>Fairfax County Jobs,<br>by Quintile Group", 
            opacity = 1,
            labFormat = function(type = "quantile", cuts = 5, p = perTotalJobs) {
                    n = length(cuts)
                    paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
                  })
```

# References
https://www.virginiabusiness.com/article/35-virginia-companies-make-2020-fortune-1000-list/
https://virginiaworks.com/