---
title: "Fairfax County Networks"
description: "Project description here"
tags: ["R", "geospatial"]
weight: 5
draft: false
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidycensus)
library(leaflet)
library(sf)
library(shiny)
library(fabricatr)
library(RColorBrewer)

source("/sfs/qumulo/qhome/sm9dv/dspg20fairfax/src/09_network_descriptives/network_functions.R")
network_stats(vars = "S000", years = 2015, types = types)
```

# Fairfax County Networks

We employ network analysis to understand the flow of Fairfax County workers from their residence to the workplace at the Census tract-level. 

## Data and Methods

The LODES data is produced by the US Census Bureau in order to better understand where workers reside and work. There are three main datasets of the LODES data; we use the Origin-Destination files for our networks, and restrict the geography to intra-Fairfax County tracts only. The LODES OD data is produced for three aggregations: total jobs, federal jobs, and private jobs.



### Interpretation of Centrality Measures

Measure | Interpretation
---------|--------------------------------
Weighted Out-Degree Centrality | These plots highlight tracts from which individuals depart to get to their jobs in other tracts.
Weighted In-Degree Centrality | These plots highlight tracts that are work destinations.
Betweenness Centrality | The plots highlight tracts that serve as bridges for workers from disparate tracts to flow through.
Eigenvector Centrality | The plots highlight tracts that are more important based on they are connected to other well-connected tracts

i guess it just means that those high-traveled areas take on more travel flow and infrastructure stress than all other areas. not really that intersting.

## Findings

the findings are a little tougher. i think the in and out-degree are relatively straight-forward. we see workers from the county shift from west to east which tells us about (travel flows at certain times of days) as well as which areas of the county are going to be most busy at certain times of days and how this could impact infrastructure, etc.

the betweenness seems to reflect "flow between" areas which the county could market to emerging industries or other shops as areas that could be easily accessible for workers that are traveling to and from home and work. one could argue that the betweenness centrality of certain tracts could be an indicator of emerging areas for new businesses to setup shop. you might need to take a closer look at this, but when i look at this map from our gentrification work it looks to map closely on to the betweenness centrality map you created it. thus, this would validate that network analysis helps provide some capacity of predicting emerging economic geographies and, in turn, further indicates that infrastructure will need to be built to reflect these emerging trends.


The plots below show the centrality measures for all jobs in Fairfax County. The top, left-hand plot shows weighted out-degree centrality by quantile group.

> Interpreting Quantiles: The map visualizes values on the selected indicator at tract level. Counties with darker map colors have higher values on the selected indicator. Conversely, counties with lighter colors have lower values on the selected indicator. To facilitate comparisons and display quintile cut-off points, map colors represent quintile-grouped values.



##### All JOBS

```{r, echo = F}
leaflet_creator("all")
fluidRow(column(6, l_out_2015_S000_all), 
         column(6, l_in_2015_S000_all))
fluidRow(column(6, l_btw_2015_S000_all), 
         column(6, l_eigen_2015_S000_all))
```

### Federal Jobs

```{r, echo = F}
type = "federal"
nodelist <- get(paste("nodelist_2015_S000_", type, sep = ""))
  
  
nodelist$color_in <- ifelse(nodelist$wtd_deg_cent_in == 0, "[0]", 
                        ifelse(nodelist$wtd_deg_cent_in < 1000 & 100 <= nodelist$wtd_deg_cent_in, "[100-1000)",
                              ifelse(nodelist$wtd_deg_cent_in < 100 &  10 <= nodelist$wtd_deg_cent_in, "[10-100)", 
                                     "[1-10)")))
nodelist$color_btw <- ifelse(nodelist$btw_cent == 0, "[0]", 
                        ifelse(nodelist$btw_cent < 1000 & 100 <= nodelist$btw_cent, "[100-1000)",
                              ifelse(nodelist$btw_cent < 100 &  10 <= nodelist$btw_cent, "[10-100)", 
                                     "[1-10)")))
nodelist$color_eigen <- ifelse(nodelist$eigen_cent == 0, "[0]", 
                        ifelse(nodelist$eigen_cent < 1 & .1 <= nodelist$eigen_cent, "[.1-1)",
                              ifelse(nodelist$eigen_cent < 0.01 &  0 < nodelist$eigen_cent, "(0-.01)", 
                                     "[.01-.1)")))
  
nodelist$color_eigen <- ordered(nodelist$color_eigen, levels = c("[0]", "(0-.01)","[.01-.1)", "[.1-1)"))
fairfax_data <- merge(data_fairfax[, c("GEOID", "geometry")], nodelist[, c("tract", "wtd_deg_cent_out", "wtd_deg_cent_in", "btw_cent", "eigen_cent", "color_in", "color_btw","color_eigen")], by.x= "GEOID", by.y = "tract", all = TRUE)
  
fairfax_data <- st_transform(fairfax_data, 4326)
pal_out <- colorQuantile("Blues",5,  domain = fairfax_data$wtd_deg_cent_out)
pal_in <- colorFactor(brewer.pal(n = 4, name = "Oranges"), fairfax_data$color_in)
pal_btw <- colorFactor(brewer.pal(n = 4, name = "Purples"), fairfax_data$color_btw)
pal_eigen <- colorFactor(brewer.pal(n = 4, name = "Greens"), fairfax_data$color_eigen)
l_out_2015_S000_federal <- leaflet(data = fairfax_data,options = leafletOptions(minZoom = 10))%>%
  addTiles("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png") %>%
  addPolygons(fillColor = ~pal_out(wtd_deg_cent_out), fillOpacity = .8, stroke = FALSE) %>%
  addLegend("bottomleft", 
            pal = pal_out, 
            values =  ~wtd_deg_cent_out,
            title = "Weighted Degree Centrality: Out<br> By Quantile Group", 
            opacity = 1, 
            labFormat = function(type = "quantile", cuts = 10, p = wtd_deg_cent_out) {
              n = length(cuts)
              paste0("[", round(cuts[-n], 3), " &ndash; ", round(cuts[-1], 3), ")")
            })
l_in_2015_S000_federal <- leaflet(data = fairfax_data,options = leafletOptions(minZoom = 10))%>%
  addTiles("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png") %>%
  addPolygons(fillColor = ~pal_in(color_in), fillOpacity = .8, stroke = FALSE) %>%
  addLegend("bottomleft", 
            pal = pal_in, 
            values = ~color_in,
            title = "Weighted Degree Centrality: In<br>", 
            opacity = 1
          )
l_btw_2015_S000_federal <- leaflet(data = fairfax_data,options = leafletOptions(minZoom = 10))%>%
  addTiles("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png") %>%
  addPolygons(fillColor = ~pal_btw(color_btw), fillOpacity = .8, stroke = FALSE) %>%
  addLegend("bottomleft", 
            pal = pal_btw, 
            values = ~color_btw,
            title = "Betweenness Centrality<br>", 
            opacity = 1)
l_eigen_2015_S000_federal <- leaflet(data = fairfax_data, options = leafletOptions(minZoom = 10))%>%
  addTiles("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png") %>%
  addPolygons(fillColor = ~pal_eigen(color_eigen), fillOpacity = .8, stroke = FALSE) %>%
  addLegend("bottomleft", 
            pal = pal_eigen, 
            values = ~color_eigen,
            title = "Eigen Centrality<br>", 
            opacity = 1)

fluidRow(column(6, l_out_2015_S000_federal), 
         column(6, l_in_2015_S000_federal))
fluidRow(column(6, l_btw_2015_S000_federal), 
         column(6, l_eigen_2015_S000_federal))
```

### Private Jobs

```{r, echo = F}
leaflet_creator("private")
fluidRow(column(6, l_out_2015_S000_private), 
         column(6, l_in_2015_S000_private))
fluidRow(column(6, l_btw_2015_S000_private), 
         column(6, l_eigen_2015_S000_private))
```


# References
Citations here.